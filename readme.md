##Задание №2 ШРИ-2015
###Задание
1.Найдите ошибку в коде приложения, из-за которой реальный результат работы отличается от ожидаемого.
Опишите, как эта ошибка могла возникнуть и как её избежать в будущем.

2.Добавьте в приложение новую возможность — диалог с пользователем.
Приложение спрашивает название страны или города, а затем показывает численность населения. Для диалога можно использовать window.prompt.

###Проблема
Проблема состоит в том, что коллбек вызывается асинхронно после полного прохода цикла, а переменная request будет иметь значение,
равное ее значению в последней итерации цикла. Это происходит потому что в js область видимости формируют только функции,
а в данном примере переменная объявлена в глобальной области видимости и перезаписывается с каждой итерацией.

###Решение

Самое простое и быстрое решение - обернуть создание коллбека в самовызывающуюся функцию и сохранить значение request в ней,
например просто передав ее как параметр. [Код](https://github.com/DmitryDorofeev/population/blob/simple-solution/shri.js)

Еще одно похожее решение - использовать forEach из ES5 вместо for. [Код](https://github.com/DmitryDorofeev/population/blob/foreach/shri.js)

Ну и наконец можно использовать промисы. Тут мы убиваем сразу двух зайцев: получаем удобное управление коллбеками и возможность повесить
коллбек на резолв нескольких промисов. Долго думал, переписывать код, либо максимально использовать существующий,
в итоге чувство технического долга перевесило и я переписал. С ES2015 в ES5 трансформировал с помощью babel.js. Если браузер не поддерживает промисы,
используется библиотека Q.js

Код с новым функционалом [тут](https://github.com/DmitryDorofeev/population/blob/master/shri.js)

Как избежать беды в будущем:

1. По возможности не создавать функции в цикле

2. Если все-таки возможности такой нет, то сделать фабрику коллбеков

3. forEach - добро, если мы не экономим на спичках
